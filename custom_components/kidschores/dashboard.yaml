views:
  - title: Kids Chores
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-chips-card
            alignment: center
            chips:
              - type: template
                icon: mdi:account-child
                content: John
                icon_color: >-
                  {% if states('input_select.kidschores_active_kid') == 'John' %}
                  primary
                  {% else %}
                  disabled
                  {% endif %}
                tap_action:
                  action: call-service
                  service: input_select.select_option
                  data:
                    option: John
                  target:
                    entity_id: input_select.kidschores_active_kid
              - type: template
                icon: mdi:account-child-circle
                content: Jess
                icon_color: >-
                  {% if states('input_select.kidschores_active_kid') == 'Jess' %}
                  primary
                  {% else %}
                  disabled
                  {% endif %}
                tap_action:
                  action: call-service
                  service: input_select.select_option
                  data:
                    option: Jess
                  target:
                    entity_id: input_select.kidschores_active_kid
          - type: conditional
            conditions:
              - entity: input_select.kidschores_active_kid
                state: John
            card:
              type: vertical-stack
              cards:
                - type: markdown
                  content: >-
                    ## John's Chores
                    Tap a card to claim the chore when it is finished.
                - type: custom:auto-entities
                  card:
                    type: grid
                    columns: 2
                    square: false
                  filter:
                    template: >-
                      {% set kid_slug = 'john' %}
                      {% set status_prefix = 'sensor.kc_' ~ kid_slug ~ '_chore_status_' %}
                      {% for item in states.sensor | selectattr('entity_id', 'match', '^' ~ status_prefix) | list %}
                        {% if item.state in ['pending', 'overdue'] %}
                          {{
                            {
                              'type': 'custom:mushroom-template-card',
                              'primary': state_attr(item.entity_id, 'chore_name') or item.name,
                              'secondary': (
                                ('Overdue · ' if item.state == 'overdue' else '') ~
                                (
                                  'Due: ' ~ state_attr(item.entity_id, 'due_date')
                                  if state_attr(item.entity_id, 'due_date') not in [None, 'Not set']
                                  else 'Tap to mark complete'
                                )
                              ),
                              'icon': state_attr(item.entity_id, 'icon') or 'mdi:clipboard-check-outline',
                              'icon_color': 'red' if item.state == 'overdue' else 'green',
                              'tap_action': {
                                'action': 'call-service',
                                'service': 'button.press',
                                'target': {
                                  'entity_id': item.entity_id
                                    | replace('sensor.', 'button.')
                                    | replace('_chore_status_', '_chore_claim_')
                                }
                              },
                              'hold_action': {'action': 'more-info'}
                            }
                          }},
                        {% endif %}
                      {% endfor %}
                - type: markdown
                  content: >-
                    {% set kid_name = 'John' %}
                    {% set kid_slug = kid_name | slugify %}
                    {% set points_entity = 'sensor.kc_' ~ kid_slug ~ '_points' %}
                    {% set weekly_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_weekly' %}
                    {% set daily_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_daily' %}
                    {% set total_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_total' %}
                    {% set badge_entity = 'sensor.kc_' ~ kid_slug ~ '_highest_badge' %}
                    {% set achievements = states.sensor | selectattr('entity_id', 'match', '^sensor.kc_' ~ kid_slug ~ '_achievement_status_') | list %}
                    {% set challenges = states.sensor | selectattr('entity_id', 'match', '^sensor.kc_' ~ kid_slug ~ '_challenge_status_') | list %}
                    {% set ns = namespace(achievements=[], challenges=[]) %}
                    {% for ach in achievements %}
                      {% set ach_name = state_attr(ach.entity_id, 'achievement_name') or ach.name %}
                      {% set ach_progress = (ach.state | float(default=0)) | round(0) %}
                      {% set ach_awarded = state_attr(ach.entity_id, 'awarded') in ['true', True] %}
                      {% set ns.achievements = ns.achievements + ['- ' ~ ach_name ~ ': ' ~ ('Completed' if ach_awarded else (ach_progress|string ~ '%'))] %}
                    {% endfor %}
                    {% for challenge in challenges %}
                      {% set challenge_name = state_attr(challenge.entity_id, 'challenge_name') or challenge.name %}
                      {% set challenge_progress = (challenge.state | float(default=0)) | round(0) %}
                      {% set challenge_awarded = state_attr(challenge.entity_id, 'awarded') in ['true', True] %}
                      {% set ns.challenges = ns.challenges + ['- ' ~ challenge_name ~ ': ' ~ ('Completed' if challenge_awarded else (challenge_progress|string ~ '%'))] %}
                    {% endfor %}
                    {% set badge_name = states(badge_entity) %}
                    {% set badge_icon = state_attr(badge_entity, 'icon') or 'mdi:medal-outline' %}
                    {% set badge_multiplier = state_attr(badge_entity, 'points_multiplier') | default(1) %}
                    ## {{ kid_name }} Showcase
                    * **Points:** {{ states(points_entity) | int(default=0) }} {{ state_attr(points_entity, 'unit_of_measurement') or 'pts' }}
                    * **Today:** {{ states(daily_entity) | int(default=0) }} completed
                    * **This Week:** {{ states(weekly_entity) | int(default=0) }} completed
                    * **All Time:** {{ states(total_entity) | int(default=0) }} completed
                    * **Top Badge:** <ha-icon icon="{{ badge_icon }}"></ha-icon>
                      {{ badge_name if badge_name not in [None, 'unknown', 'unavailable'] else 'None yet' }}
                      {% if badge_multiplier | float(default=1) > 1 %}(x{{ badge_multiplier | float(default=1) }}){% endif %}

                    {% if ns.achievements %}
                    ### Achievements
                    {{ ns.achievements | join('\n') }}
                    {% endif %}

                    {% if ns.challenges %}
                    ### Challenges
                    {{ ns.challenges | join('\n') }}
                    {% endif %}
          - type: conditional
            conditions:
              - entity: input_select.kidschores_active_kid
                state: Jess
            card:
              type: vertical-stack
              cards:
                - type: markdown
                  content: >-
                    ## Jess's Chores
                    Tap a card to claim the chore when it is finished.
                - type: custom:auto-entities
                  card:
                    type: grid
                    columns: 2
                    square: false
                  filter:
                    template: >-
                      {% set kid_slug = 'jess' %}
                      {% set status_prefix = 'sensor.kc_' ~ kid_slug ~ '_chore_status_' %}
                      {% for item in states.sensor | selectattr('entity_id', 'match', '^' ~ status_prefix) | list %}
                        {% if item.state in ['pending', 'overdue'] %}
                          {{
                            {
                              'type': 'custom:mushroom-template-card',
                              'primary': state_attr(item.entity_id, 'chore_name') or item.name,
                              'secondary': (
                                ('Overdue · ' if item.state == 'overdue' else '') ~
                                (
                                  'Due: ' ~ state_attr(item.entity_id, 'due_date')
                                  if state_attr(item.entity_id, 'due_date') not in [None, 'Not set']
                                  else 'Tap to mark complete'
                                )
                              ),
                              'icon': state_attr(item.entity_id, 'icon') or 'mdi:clipboard-check-outline',
                              'icon_color': 'red' if item.state == 'overdue' else 'green',
                              'tap_action': {
                                'action': 'call-service',
                                'service': 'button.press',
                                'target': {
                                  'entity_id': item.entity_id
                                    | replace('sensor.', 'button.')
                                    | replace('_chore_status_', '_chore_claim_')
                                }
                              },
                              'hold_action': {'action': 'more-info'}
                            }
                          }},
                        {% endif %}
                      {% endfor %}
                - type: markdown
                  content: >-
                    {% set kid_name = 'Jess' %}
                    {% set kid_slug = kid_name | slugify %}
                    {% set points_entity = 'sensor.kc_' ~ kid_slug ~ '_points' %}
                    {% set weekly_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_weekly' %}
                    {% set daily_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_daily' %}
                    {% set total_entity = 'sensor.kc_' ~ kid_slug ~ '_chores_completed_total' %}
                    {% set badge_entity = 'sensor.kc_' ~ kid_slug ~ '_highest_badge' %}
                    {% set achievements = states.sensor | selectattr('entity_id', 'match', '^sensor.kc_' ~ kid_slug ~ '_achievement_status_') | list %}
                    {% set challenges = states.sensor | selectattr('entity_id', 'match', '^sensor.kc_' ~ kid_slug ~ '_challenge_status_') | list %}
                    {% set ns = namespace(achievements=[], challenges=[]) %}
                    {% for ach in achievements %}
                      {% set ach_name = state_attr(ach.entity_id, 'achievement_name') or ach.name %}
                      {% set ach_progress = (ach.state | float(default=0)) | round(0) %}
                      {% set ach_awarded = state_attr(ach.entity_id, 'awarded') in ['true', True] %}
                      {% set ns.achievements = ns.achievements + ['- ' ~ ach_name ~ ': ' ~ ('Completed' if ach_awarded else (ach_progress|string ~ '%'))] %}
                    {% endfor %}
                    {% for challenge in challenges %}
                      {% set challenge_name = state_attr(challenge.entity_id, 'challenge_name') or challenge.name %}
                      {% set challenge_progress = (challenge.state | float(default=0)) | round(0) %}
                      {% set challenge_awarded = state_attr(challenge.entity_id, 'awarded') in ['true', True] %}
                      {% set ns.challenges = ns.challenges + ['- ' ~ challenge_name ~ ': ' ~ ('Completed' if challenge_awarded else (challenge_progress|string ~ '%'))] %}
                    {% endfor %}
                    {% set badge_name = states(badge_entity) %}
                    {% set badge_icon = state_attr(badge_entity, 'icon') or 'mdi:medal-outline' %}
                    {% set badge_multiplier = state_attr(badge_entity, 'points_multiplier') | default(1) %}
                    ## {{ kid_name }} Showcase
                    * **Points:** {{ states(points_entity) | int(default=0) }} {{ state_attr(points_entity, 'unit_of_measurement') or 'pts' }}
                    * **Today:** {{ states(daily_entity) | int(default=0) }} completed
                    * **This Week:** {{ states(weekly_entity) | int(default=0) }} completed
                    * **All Time:** {{ states(total_entity) | int(default=0) }} completed
                    * **Top Badge:** <ha-icon icon="{{ badge_icon }}"></ha-icon>
                      {{ badge_name if badge_name not in [None, 'unknown', 'unavailable'] else 'None yet' }}
                      {% if badge_multiplier | float(default=1) > 1 %}(x{{ badge_multiplier | float(default=1) }}){% endif %}

                    {% if ns.achievements %}
                    ### Achievements
                    {{ ns.achievements | join('\n') }}
                    {% endif %}

                    {% if ns.challenges %}
                    ### Challenges
                    {{ ns.challenges | join('\n') }}
                    {% endif %}
